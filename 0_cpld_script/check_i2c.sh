#!/bin/sh
#######################################
# this sh script conatin following  feature:
# # count specific second elapsed
# # exec command every specific second
# # stop while different output occur
# zswang
#######################################

#######################################
# System Setting
#######################################
SLPTIME=1 # time interval between each command

#######################################
# Function Variable
# FUNC is the command to be executed.
# example_FUNC_Dump2="Fri Jun 11 09:54:04 2021
# Clock is set as 400KHz
# Master write, master read mode, address 0xC6
# Write Length 1, Data=
# 0x00
# Received Data Length is 256 with data =
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A 0x5A
# Write Done!"
#######################################
FUNC1() {
        # print libi2ctest result and trim 1~6 & last lines. 
        result= libi2ctest -c 32 100 100 0 -a 0xc6 -m 0 1 0 256 | sed '1,6d' | sed '$d'
        echo $result
}
FUNC2() {
        # print libi2ctest result and trim 1~6 & last lines. 
        result= libi2ctest -c 32 400 100 0 -a 0xc6 -m 0 1 0 256 | sed '1,6d' | sed '$d'
        echo $result
}

#######################################
# Main
#######################################
#  initial value. (tested)
oldValue="$(FUNC1)"
elapsedTime=0 
# loop sceond. (tested)
while sleep $SLPTIME
do 
    # check if  value changed. (tested)
    [ $(($elapsedTime%2)) -eq 0 ] && newValue="$(FUNC1)" || newValue="$(FUNC2)"
    # check similarity (tested)
    if [ "$oldValue" != "$newValue" ]
    then 
        printf "something diff! at $elapsedTime sec.\n"
        printf "new value\n"
        printf "$newValue\n"
        printf "old value\n"
        printf "$oldValue\n"
        break
    fi
    #  if value is not changed, fill in old value. (tested)
    oldValue=$newValue
    # calculate elapsed time. (tested)
    elapsedTime=$(($elapsedTime+$SLPTIME))
    # wipe out the console output (tested)
    clear
    # print new value & time (tested)
    printf "$newValue\n"
    printf "elapsed $elapsedTime sec\n"
done
